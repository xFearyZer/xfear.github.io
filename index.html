<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Đọc truyện online</title>
<style>
body { font-family: Arial, sans-serif; background: #f4f4f4; margin:0; padding:0;}
.container { max-width: 900px; margin: 50px auto; background:#fff; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
input[type=text], input[type=password] { width:100%; padding:10px; margin:10px 0; }
button { padding:10px 20px; background:#007BFF; color:#fff; border:none; cursor:pointer; }
button:hover { background:#0056b3; }
.nav { display:flex; justify-content:space-between; margin-bottom:20px; }
.story-card { display:flex; align-items:center; background:#eee; margin:10px 0; padding:10px; border-radius:6px; cursor:pointer;}
.story-card img { width:60px; height:80px; object-fit:cover; margin-right:15px; border-radius:4px;}
.story-card:hover { background:#ddd; }
</style>
</head>
<body>

<div class="container" id="loginDiv">
<h2>Đăng nhập để đọc truyện</h2>
<input type="text" id="username" placeholder="Tên đăng nhập">
<input type="password" id="password" placeholder="Mật khẩu">
<button onclick="login()">Đăng nhập</button>
<p id="errorMsg" style="color:red;"></p>
</div>

<div class="container" id="storyDiv" style="display:none;">
<div class="nav">
<h2>Danh sách truyện</h2>
<button onclick="logout()">Đăng xuất</button>
</div>
<div id="storyList"></div>
</div>

<script>
const USER = "admin";
const PASS = "1234";
let stories = JSON.parse(localStorage.getItem("stories") || "[]");

function login() {
    const u = document.getElementById("username").value;
    const p = document.getElementById("password").value;
    if(u === USER && p === PASS){
        document.getElementById("loginDiv").style.display = "none";
        document.getElementById("storyDiv").style.display = "block";
        renderStories();
    } else {
        document.getElementById("errorMsg").innerText = "Sai tài khoản hoặc mật khẩu!";
    }
}

function logout() {
    document.getElementById("loginDiv").style.display = "block";
    document.getElementById("storyDiv").style.display = "none";
}

function renderStories() {
    const list = document.getElementById("storyList");
    list.innerHTML = "";
    if(stories.length === 0){
        list.innerHTML = "<p>Chưa có truyện nào.</p>";
        return;
    }
    stories.forEach((s,i)=>{
        const div = document.createElement("div");
        div.className = "story-card";
        div.innerHTML = `<img src="${s.cover}" alt="cover"><div><b>${s.storyName}</b><br>${s.chapters.length} chap</div>`;
        div.onclick = ()=> { openStory(s); };
        list.appendChild(div);
    });
}

function openStory(story) {
    let chapIndex = 0;
    const w = window.open("", "_blank", "width=900,height=700");
    function renderChap() {
        w.document.body.innerHTML = "";
        const div = w.document.createElement("div");
        div.innerHTML = story.chapters[chapIndex].content;
        w.document.body.appendChild(div);

        const nav = w.document.createElement("div");
        nav.style.marginTop = "20px";

        if(chapIndex > 0){
            const prevBtn = w.document.createElement("button");
            prevBtn.innerText = "Chap trước";
            prevBtn.onclick = ()=>{ chapIndex--; renderChap(); };
            nav.appendChild(prevBtn);
        }

        const nextBtn = w.document.createElement("button");
        nextBtn.innerText = chapIndex < story.chapters.length-1 ? "Chap sau" : "Kết thúc";
        nextBtn.style.marginLeft="10px";
        nextBtn.onclick = ()=>{
            if(chapIndex < story.chapters.length-1){ chapIndex++; renderChap(); }
            else { w.close(); }
        };
        nav.appendChild(nextBtn);

        w.document.body.appendChild(nav);
    }
    renderChap();
}
</script>
</body>
</html>